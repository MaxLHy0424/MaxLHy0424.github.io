---
import I18nKey from "../../i18n/i18nKey";
import { i18n } from "../../i18n/translation";
import Icon from "../misc/Icon.astro";

export interface Props {
	skill: {
		id: string;
		name: string;
		description: string;
		icon?: string;
		category: string;
		level: "beginner" | "intermediate" | "advanced" | "expert";
		experience: string;
		relatedProjects?: string[];
		certifications?: string[];
		color?: string;
	};
	size?: "small" | "medium" | "large";
	showProgress?: boolean;
	showIcon?: boolean;
}

const {
	skill,
	size = "medium",
	showProgress = true,
	showIcon = true,
} = Astro.props;

// æŠ€èƒ½ç­‰çº§é¢œè‰²æ˜ å°„
const getLevelColor = (level: string) => {
	switch (level) {
		case "expert":
			return "bg-red-600/20 text-red-700 dark:bg-red-900/30 dark:text-red-400";
		case "advanced":
			return "bg-orange-600/20 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400";
		case "intermediate":
			return "bg-yellow-600/20 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400";
		case "beginner":
			return "bg-green-600/20 text-green-700 dark:bg-green-900/30 dark:text-green-400";
		default:
			return "bg-gray-600/20 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400";
	}
};

// æŠ€èƒ½ç­‰çº§æ–‡æœ¬æ˜ å°„
const getLevelText = (level: string) => {
	switch (level) {
		case "expert":
			return i18n(I18nKey.skillsExpert);
		case "advanced":
			return i18n(I18nKey.skillsAdvanced);
		case "intermediate":
			return i18n(I18nKey.skillsIntermediate);
		case "beginner":
			return i18n(I18nKey.skillsBeginner);
		default:
			return level;
	}
};

// æŠ€èƒ½ç­‰çº§è¿›åº¦æ¡å®½åº¦
const getLevelWidth = (level: string) => {
	switch (level) {
		case "expert":
			return "100%";
		case "advanced":
			return "80%";
		case "intermediate":
			return "60%";
		case "beginner":
			return "40%";
		default:
			return "20%";
	}
};

// å°ºå¯¸æ ·å¼æ˜ å°„
const getSizeClasses = (size: string) => {
	switch (size) {
		case "small":
			return {
				container: "p-4",
				icon: "w-8 h-8",
				iconText: "text-lg",
				title: "text-base",
				description: "text-xs line-clamp-2",
				badge: "text-xs",
				progress: "h-1.5",
			};
		case "large":
			return {
				container: "p-6",
				icon: "w-14 h-14",
				iconText: "text-3xl",
				title: "text-xl",
				description: "text-sm line-clamp-3",
				badge: "text-sm",
				progress: "h-3",
			};
		default: // medium
			return {
				container: "p-5",
				icon: "w-10 h-10",
				iconText: "text-xl",
				title: "text-lg",
				description: "text-sm line-clamp-2",
				badge: "text-xs",
				progress: "h-2",
			};
	}
};

const sizeClasses = getSizeClasses(size);
const skillColor = skill.color || "#3B82F6";
---

<div class="bg-transparent rounded-lg border border-black/10 dark:border-white/10 overflow-hidden hover:shadow-lg transition-all duration-300 group">
  <div class={sizeClasses.container}>
    <div class="flex items-start gap-4">
      <!-- æŠ€èƒ½å›¾æ ‡ -->
      {showIcon && skill.icon && (
        <div class={`rounded-lg flex items-center justify-center shrink-0 ${sizeClasses.icon}`} style={`background-color: ${skillColor}20`}>
          <Icon 
            icon={skill.icon} 
            class={sizeClasses.iconText} 
            color={skillColor}
            fallback={skill.name.charAt(0)}
            loading="eager"
          />
        </div>
      )}
      
      <div class="flex-1 min-w-0">
        <!-- æŠ€èƒ½åç§°å’Œç­‰çº§ -->
        <div class="flex items-center justify-between mb-2">
          <h3 class={`font-semibold text-black/90 dark:text-white/90 ${sizeClasses.title} ${size === 'small' ? 'truncate' : ''}`}>
            {skill.name}
          </h3>
          <span class={`px-2 py-1 rounded-full shrink-0 ml-2 ${sizeClasses.badge} ${getLevelColor(skill.level)}`}>
            {getLevelText(skill.level)}
          </span>
        </div>
        
        <!-- åˆ†ç±»æ ‡ç­¾ -->
        {skill.category && (
          <div class="mb-2">
            <span class={`px-2 py-1 bg-blue-600/20 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 rounded ${sizeClasses.badge}`}>
              {skill.category}
            </span>
          </div>
        )}
        
        <!-- æŠ€èƒ½æè¿° -->
        <p class={`text-black/60 dark:text-white/60 mb-3 ${sizeClasses.description}`}>
          {skill.description}
        </p>
        
        <!-- ç»éªŒå’Œè¿›åº¦æ¡ -->
        {showProgress && (
          <div class="mb-3">
            <div class="flex justify-between text-sm mb-1">
              <span class="text-black/60 dark:text-white/60">{i18n(I18nKey.skillExperience)}</span>
              <span class="text-black/80 dark:text-white/80">{skill.experience}</span>
            </div>
            <div class={`w-full bg-gray-200 dark:bg-gray-700 rounded-full ${sizeClasses.progress}`}>
              <div 
                class={`rounded-full transition-all duration-500 ${sizeClasses.progress}`}
                style={`width: ${getLevelWidth(skill.level)}; background-color: ${skillColor}`}
              ></div>
            </div>
          </div>
        )}
        
        <!-- è®¤è¯ä¿¡æ¯ -->
        {skill.certifications && skill.certifications.length > 0 && (
          <div class="mb-3">
            <div class="flex flex-wrap gap-1">
              {skill.certifications.map((cert) => (
                <span class={`px-2 py-1 bg-green-600/20 text-green-700 dark:bg-green-900/30 dark:text-green-400 rounded ${sizeClasses.badge}`}>
                  ğŸ† {cert}
                </span>
              ))}
            </div>
          </div>
        )}
        
        <!-- ç›¸å…³é¡¹ç›® -->
        {skill.relatedProjects && skill.relatedProjects.length > 0 && (
          <div class="text-sm text-black/60 dark:text-white/60">
            {i18n(I18nKey.skillsProjects)}: {skill.relatedProjects.length}
          </div>
        )}
      </div>
    </div>
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  // ç›‘å¬å›¾æ ‡åŠ è½½å®Œæˆäº‹ä»¶
  document.addEventListener('DOMContentLoaded', () => {
    const skillCard = document.currentScript?.parentElement;
    if (skillCard) {
      skillCard.classList.add('skill-card');
      
      // ç›‘å¬å›¾æ ‡å‡†å¤‡å°±ç»ªäº‹ä»¶
      skillCard.addEventListener('iconify-ready', () => {
        // å›¾æ ‡åŠ è½½å®Œæˆï¼Œå¯ä»¥æ‰§è¡Œé¢å¤–çš„åˆå§‹åŒ–é€»è¾‘
        skillCard.classList.add('icons-loaded');
      });
    }
  });
</script>